!function(e,t){ true?module.exports=t():undefined}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.oe=function(e){throw e},t.p="",t(t.s=5)}([function(e,t,n){var i=!1;!function(t){function n(){this._events={},this._conf&&r.call(this,this._conf)}function r(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function s(e){this._events={},this.newListener=!1,r.call(this,e)}function o(e,t,n,i){if(!n)return[];var r,s,l,a,c,u,f,h=[],p=t.length,_=t[i],v=t[i+1];if(i===p&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,s=n._listeners.length;s>r;r++)e&&e.push(n._listeners[r]);return[n]}if("*"===_||"**"===_||n[_]){if("*"===_){for(l in n)"_listeners"!==l&&n.hasOwnProperty(l)&&(h=h.concat(o(e,t,n[l],i+1)));return h}if("**"===_){f=i+1===p||i+2===p&&"*"===v,f&&n._listeners&&(h=h.concat(o(e,t,n,p)));for(l in n)"_listeners"!==l&&n.hasOwnProperty(l)&&("*"===l||"**"===l?(n[l]._listeners&&!f&&(h=h.concat(o(e,t,n[l],p))),h=h.concat(o(e,t,n[l],i))):h=l===v?h.concat(o(e,t,n[l],i+2)):h.concat(o(e,t,n[l],i)));return h}h=h.concat(o(e,t,n[_],i+1))}if(a=n["*"],a&&o(e,t,a,i+1),c=n["**"])if(p>i){c._listeners&&o(e,t,c,p);for(l in c)"_listeners"!==l&&c.hasOwnProperty(l)&&(l===v?o(e,t,c[l],i+2):l===_?o(e,t,c[l],i+1):(u={},u[l]=c[l],o(e,t,{"**":u},i+1)))}else c._listeners?o(e,t,c,p):c["*"]&&c["*"]._listeners&&o(e,t,c["*"],p);return h}function l(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;i>n+1;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var r=this.listenerTree,s=e.shift();s;){if(r[s]||(r[s]={}),r=r[s],0===e.length){if(r._listeners){if("function"==typeof r._listeners)r._listeners=[r._listeners,t];else if(a(r._listeners)&&(r._listeners.push(t),!r._listeners.warned)){var o=c;"undefined"!=typeof this._events.maxListeners&&(o=this._events.maxListeners),o>0&&r._listeners.length>o&&(r._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",r._listeners.length),console.trace&&console.trace())}}else r._listeners=t;return!0}s=e.shift()}return!0}var a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=10;s.EventEmitter2=s,s.prototype.delimiter=".",s.prototype.setMaxListeners=function(e){this._events||n.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},s.prototype.event="",s.prototype.once=function(e,t){return this.many(e,1,t),this},s.prototype.many=function(e,t,n){function i(){0===--t&&r.off(e,i),n.apply(this,arguments)}var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},s.prototype.emit=function(){this._events||n.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var t=arguments.length,i=new Array(t-1),r=1;t>r;r++)i[r-1]=arguments[r];for(r=0,t=this._all.length;t>r;r++)this.event=e,this._all[r].apply(this,[e].concat(i))}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var l="string"==typeof e?e.split(this.delimiter):e.slice();o.call(this,s,l,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s){if(this.event=e,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var t=arguments.length,i=new Array(t-1),r=1;t>r;r++)i[r-1]=arguments[r];s.apply(this,i)}return!0}if(s){for(var t=arguments.length,i=new Array(t-1),r=1;t>r;r++)i[r-1]=arguments[r];for(var a=s.slice(),r=0,t=a.length;t>r;r++)this.event=e,a[r].apply(this,i);return a.length>0||!!this._all}return!!this._all},s.prototype.emitAsync=function(){this._events||n.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t=[];if(this._all){for(var i=arguments.length,r=new Array(i-1),s=1;i>s;s++)r[s-1]=arguments[s];for(s=0,i=this._all.length;i>s;s++)this.event=e,t.push(this._all[s].apply(this,r))}if("error"===e&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");var l;if(this.wildcard){l=[];var a="string"==typeof e?e.split(this.delimiter):e.slice();o.call(this,l,a,this.listenerTree,0)}else l=this._events[e];if("function"==typeof l){if(this.event=e,1===arguments.length)t.push(l.call(this));else if(arguments.length>1)switch(arguments.length){case 2:t.push(l.call(this,arguments[1]));break;case 3:t.push(l.call(this,arguments[1],arguments[2]));break;default:for(var i=arguments.length,r=new Array(i-1),s=1;i>s;s++)r[s-1]=arguments[s];t.push(l.apply(this,r))}}else if(l){for(var i=arguments.length,r=new Array(i-1),s=1;i>s;s++)r[s-1]=arguments[s];for(var c=l.slice(),s=0,i=c.length;i>s;s++)this.event=e,t.push(c[s].apply(this,r))}return Promise.all(t)},s.prototype.on=function(e,t){if("function"==typeof e)return this.onAny(e),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",e,t),this.wildcard)return l.call(this,e,t),this;if(this._events[e]){if("function"==typeof this._events[e])this._events[e]=[this._events[e],t];else if(a(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var i=c;"undefined"!=typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace&&console.trace())}}else this._events[e]=t;return this},s.prototype.onAny=function(e){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(e),this},s.prototype.addListener=s.prototype.on,s.prototype.off=function(e,n){function i(e){if(e!==t){var n=Object.keys(e);for(var r in n){var s=n[r],o=e[s];o instanceof Function||"object"!=typeof o||(Object.keys(o).length>0&&i(e[s]),0===Object.keys(o).length&&delete e[s])}}}if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");var r,s=[];if(this.wildcard){var l="string"==typeof e?e.split(this.delimiter):e.slice();s=o.call(this,null,l,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],s.push({_listeners:r})}for(var c=0;c<s.length;c++){var u=s[c];if(r=u._listeners,a(r)){for(var f=-1,h=0,p=r.length;p>h;h++)if(r[h]===n||r[h].listener&&r[h].listener===n||r[h]._origin&&r[h]._origin===n){f=h;break}if(0>f)continue;return this.wildcard?u._listeners.splice(f,1):this._events[e].splice(f,1),0===r.length&&(this.wildcard?delete u._listeners:delete this._events[e]),this.emit("removeListener",e,n),this}(r===n||r.listener&&r.listener===n||r._origin&&r._origin===n)&&(this.wildcard?delete u._listeners:delete this._events[e],this.emit("removeListener",e,n))}return i(this.listenerTree),this},s.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;i>n;n++)if(e===t[n])return t.splice(n,1),this.emit("removeListenerAny",e),this}else{for(t=this._all,n=0,i=t.length;i>n;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},s.prototype.removeListener=s.prototype.off,s.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),i=o.call(this,null,t,this.listenerTree,0),r=0;r<i.length;r++){var s=i[r];s._listeners=null}else{if(!this._events||!this._events[e])return this;this._events[e]=null}return this},s.prototype.listeners=function(e){if(this.wildcard){var t=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return o.call(this,t,i,this.listenerTree,0),t}return this._events||n.call(this),this._events[e]||(this._events[e]=[]),a(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},s.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof i&&i.amd?i(function(){return s}):e.exports=s}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(0),a=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this));return n._onMessage=function(e,t,i){if(!n._blacklist.has(t.id)){var r=e.action;return delete e.action,n.emit(r,e,t.id,i),!0}},n._blacklist=new Set,n.ignoreFrom(e),n._initialize(),n}return s(t,e),o(t,[{key:"ignoreFrom",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];n.forEach(function(t){Array.isArray(t)?e.ignoreFrom.apply(e,t):t&&e._blacklist.add(t)})}},{key:"send",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return new Promise(function(i){var r=Object.assign({},n,{action:t});chrome.runtime.sendMessage(e,r,i)})}},{key:"destroy",value:function(){chrome.runtime.onMessageExternal.removeListener(this._onMessage),this._blacklist.clear()}},{key:"_initialize",value:function(){chrome.runtime.onMessageExternal.addListener(this._onMessage)}}]),t}(l.EventEmitter2);t["default"]=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(0),a=function(e){function t(e){i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this));return n._name=e,n._port=null,n._initialize(),n}return s(t,e),o(t,[{key:"send",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(null===this._port)throw Error("Unable to send message `"+e+"`. Connection is not established");t.message=e,this._port.postMessage(t)}},{key:"sendToClient",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e===this._name)throw Error("Unable to send message to self");n.transmitToClient=e,this.send(t,n)}},{key:"close",value:function(){this._port&&this._port.disconnect(),this.removeAllListeners()}},{key:"_initialize",value:function(){var e=this;this._port=chrome.runtime.connect({name:this._name}),this._port.onMessage.addListener(this._onMessage.bind(this)),this._port.onDisconnect.addListener(function(){e._port=null})}},{key:"_onMessage",value:function(e){var t=e.message;delete e.message,this.emit(t,e,t)}}]),t}(l.EventEmitter2);t["default"]=a},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(0),a={CONNECTED:"@@internal/connected/"},c=!1,u=function(e){function t(){i(this,t);var e=r(this,Object.getPrototypeOf(t).call(this,{wildcard:!0,delimiter:"."}));if(e._onConnect=function(t){t.onMessage.addListener(e._onMessage.bind(e,t.name)),t.onDisconnect.addListener(function(){delete e._ports[t.name]}),e._ports[t.name]=t,e._emitMessage(a.CONNECTED+t.name)},c)throw Error("Unable to create multiple internal collectors");return c=!0,e._ports={},e._initialize(),e}return s(t,e),o(t,[{key:"send",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=!1,r=Object.assign({},t,{message:e});if(n&&this._ports[n])this._ports[n].postMessage(r),i=!0;else if(!n)for(var s in this._ports)this._ports[s].postMessage(r),i=!0;return i}},{key:"connected",value:function(e){var t=this;return new Promise(function(n){t._ports[e]?n():t.once(a.CONNECTED+e,n)})}},{key:"destroy",value:function(){chrome.runtime.onConnect.removeListener(this._onConnect),this._ports={},c=!1}},{key:"isInternalEvent",value:function(e){return"function"==typeof e||e===a.CONNECTED}},{key:"_initialize",value:function(){chrome.runtime.onConnect.addListener(this._onConnect)}},{key:"_onMessage",value:function(e,t){var n=t.message;if(delete t.message,t.transmitToClient){var i=t.transmitToClient;delete t.transmitToClient,this.send(n,t,i)}else this._emitMessage(n,t,e)}},{key:"_emitMessage",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];this.emit(e,t,e,n)}}]),t}(l.EventEmitter2);t["default"]=u},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(0),a=4,c=5e3,u=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?"action":arguments[1],s=arguments.length<=2||void 0===arguments[2]?"ping":arguments[2];i(this,t);var o=r(this,Object.getPrototypeOf(t).call(this,{wildcard:!0}));return o._actionField=n,o._pingMessage=o._createMessage(s),o._connect=null,o._nativeAppId=e,o._connectionAttempts=a,o._establishConnection(),o}return s(t,e),o(t,[{key:"reconnect",value:function(){var e=this;return new Promise(function(t,n){e._connect.then(t)["catch"](function(){e._connectionAttempts<1&&(e._connectionAttempts=a,e._establishConnection()),e._connect.then(t)["catch"](n)})})}},{key:"send",value:function(e,t){var n=this;return new Promise(function(i,r){n._connect.then(function(r){var s=n._createMessage(e,t);r.postMessage(s),i(s)})["catch"](r)})}},{key:"destroy",value:function(){return this._connect.then(this._disconnect.bind(this))["catch"](function(){})}},{key:"_establishConnection",value:function(){var e=this;this._connect=new Promise(function(t,n){setTimeout(function(){e.emit("service.connecting",{},"service.connecting"),e._connectionAttempts>0?(setTimeout(function(){var i=chrome.runtime.connectNative(e._nativeAppId),r=setTimeout(function(){e._disconnect(i),e._connect.then(t)["catch"](n)},c),s=function o(){clearTimeout(r),i.onMessage.removeListener(o),i.onMessage.addListener(e._onMessage.bind(e)),t(i),e.emit("service.connected",{},"service.connected")};i.onMessage.addListener(s),i.postMessage(e._pingMessage),i.onDisconnect.addListener(function(){clearTimeout(r),e._establishConnection(),e._connect.then(t)["catch"](n)})},e._connectionAttempts*(e._connectionAttempts===a?0:1e3)),e._connectionAttempts--):(n(),e.emit("service.disconnect",{},"service.disconnect"))},0)})}},{key:"_createMessage",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=Object.assign({},t);return n[this._actionField]=e,n}},{key:"_onMessage",value:function(e){if(e.hasOwnProperty(this._actionField)){var t="message."+e[this._actionField];this.emit(t,e,t)}}},{key:"_disconnect",value:function(e){this._connectionAttempts=0,e.disconnect(),this._establishConnection()}}]),t}(l.EventEmitter2);t["default"]=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=i(r),o=n(3),l=i(o),a=n(2),c=i(a),u=n(4),f=i(u);t["default"]={ExternalMessager:s["default"],InternalCollector:l["default"],InternalClient:c["default"],NativeClient:f["default"]}}])});

//# sourceURL=webpack:////home/tcagent/.buildAgent/work/af845e0f9afe3754/node_modules/extension-messaging/dist/extension-messaging.js?